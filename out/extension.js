"use strict";var pe=Object.create;var A=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var ye=(t,e)=>{for(var r in e)A(t,r,{get:e[r],enumerable:!0})},J=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of he(e))!fe.call(t,s)&&s!==r&&A(t,s,{get:()=>e[s],enumerable:!(o=ge(e,s))||o.enumerable});return t};var R=(t,e,r)=>(r=t!=null?pe(me(t)):{},J(e||!t||!t.__esModule?A(r,"default",{value:t,enumerable:!0}):r,t)),we=t=>J(A({},"__esModule",{value:!0}),t);var Ae={};ye(Ae,{activate:()=>Ue,deactivate:()=>qe,proxyServer:()=>u,requestStore:()=>y});module.exports=we(Ae);var d=R(require("vscode"));var D=R(require("http")),ve=R(require("https")),V=require("url"),K=require("crypto");var n={proxyStarted:(t,e)=>`Proxy started: localhost:${t} \u2192 ${e}`,proxyStopped:"Proxy stopped.",proxyAlreadyRunning:t=>`Webhook Inspector: Proxy is already running (port ${t}).`,proxyAlreadyStopped:"Webhook Inspector: Proxy is already stopped.",proxyStartedNotif:(t,e)=>`Webhook Inspector: Proxy started \u2713
Listening: localhost:${t}
Forwarding: ${e}`,proxyStoppedNotif:"Webhook Inspector: Proxy stopped \u2713",proxyUnexpectedStop:t=>`Proxy stopped unexpectedly: ${t}`,portInUse:t=>`Port ${t} is already in use. Please choose a different port or stop the existing process.`,portInUseNotif:t=>`Webhook Inspector: Port ${t} is already in use. Check settings to select a different port (Settings \u2192 webhookInspector.listenPort).`,invalidPort:t=>`Webhook Inspector: Invalid port number (${t}). Port must be between 1024-65535.`,invalidForwardUrl:t=>`Webhook Inspector: Invalid forward URL: "${t}". Enter a valid URL (e.g. http://localhost:3000).`,proxyStartFailed:t=>`Proxy start failed: ${t}`,unknownError:"Unknown error",serverRuntimeError:t=>`\u2717 Server runtime error: ${t}`,serverForceShutdown:"\u26A0 Server did not close within 5 seconds, forcing shutdown.",bodyTruncated:(t,e,r)=>`\u26A0 Request ${t}: Body too large (${e}MB), keeping first ${r}MB.`,forwardError:t=>`\u2717 Forward error: ${t}`,unexpectedError:t=>`\u2717 Unexpected error: ${t}`,requestReadError:t=>`\u2717 Request read error: ${t}`,forwardErrorJson:"Webhook Inspector: Forward error",unexpectedErrorJson:"Webhook Inspector: Unexpected error",targetTimeout:(t,e)=>`Target server did not respond within ${t} seconds (${e}).`,targetRefused:t=>`Target server is not responding (${t}). Make sure the server is running.`,targetReset:t=>`Target server closed the connection (${t}).`,targetNotFound:t=>`Target server not found: ${t}`,forwardErrorGeneric:(t,e)=>`Forward error (${t}): ${e}`,requestReceived:(t,e,r,o)=>`\u2192 ${t} ${e} (${r} byte${o?", truncated":""})`,responseReceived:(t,e,r)=>`\u2190 ${t} (${e}ms, ${r} byte)`,replayStart:(t,e)=>`\u{1F504} Replay: ${t} ${e}`,replayResult:(t,e)=>`\u{1F504} Replay result: ${t} (${e}ms)`,replayError:t=>`\u{1F504} Replay error: ${t}`,replayTimeout:"Replay: Target server did not respond (30s timeout).",replayWarning:"This action may cause side-effects (e.g. duplicate payment). Continue?",replayContinue:"Continue",curlCopied:(t,e)=>`\u{1F4CB} curl copied: ${t} ${e}`,curlCopiedNotif:"Webhook Inspector: curl command copied to clipboard \u2713",harExported:(t,e)=>`\u{1F4BE} HAR export: ${t} requests \u2192 ${e}`,harExportedNotif:t=>`Webhook Inspector: ${t} requests exported as HAR \u2713`,noRequestsToExport:"Webhook Inspector: No requests to export.",settingsUpdated:(t,e)=>`\u2699 Settings updated: port=${t}, url=${e}`,settingsUpdatedNotif:"Webhook Inspector: Settings updated \u2713",settingsChanged:"Webhook Inspector: Settings changed. Proxy must be restarted for changes to take effect.",settingsRestart:"Restart",historyCleared:"History cleared.",historyClearedNotif:"Webhook Inspector: Request history cleared.",licenseActivated:"\u{1F511} License activated",licenseActivatedNotif:"Webhook Inspector: Pro license activated \u2713",licenseInvalid:"\u{1F511} Invalid license key",licenseInvalidNotif:"Webhook Inspector: Invalid license key",licenseReset:"\u{1F511} License reset to Free.",licenseResetNotif:"Webhook Inspector: License reset to Free tier.",activated:"Webhook Inspector activated.",deactivated:"Webhook Inspector deactivated.",statusListening:t=>`$(circle-filled) Webhook: ${t} listening`,statusStopped:"$(circle-outline) Webhook: Stopped",tooltipActive:t=>`$(circle-filled) **Webhook Inspector** \u2014 Active

Listening: \`localhost:${t}\`

Click to open panel`,tooltipStopped:`$(circle-outline) **Webhook Inspector** \u2014 Stopped

Click to open panel`,harFileFilter:"HAR File"};var be={listenPort:3001,forwardUrl:"http://localhost:3000",forwardTimeout:3e4,maxBodySize:5*1024*1024},N=class{constructor(e,r){this.server=null;this._isRunning=!1;this.activeConnections=new Set;this.onLog=null;this.onUnexpectedStop=null;this.store=e,this.options={...be,...r}}get isRunning(){return this._isRunning}get listenPort(){return this.options.listenPort}get forwardUrl(){return this.options.forwardUrl}start(){return new Promise((e,r)=>{if(this._isRunning){r(new Error("Proxy is already running."));return}this.server=D.createServer((s,a)=>{this.handleRequest(s,a)}),this.server.on("connection",s=>{this.activeConnections.add(s),s.once("close",()=>{this.activeConnections.delete(s)})});let o=!1;this.server.on("error",s=>{o?(this.log(n.serverRuntimeError(s.message)),this._isRunning=!1,this.onUnexpectedStop&&this.onUnexpectedStop(n.proxyUnexpectedStop(s.message))):s.code==="EADDRINUSE"?r(new Error(n.portInUse(this.options.listenPort))):r(new Error(n.proxyStartFailed(s.message)))}),this.server.listen(this.options.listenPort,"127.0.0.1",()=>{o=!0,this._isRunning=!0,this.log(n.proxyStarted(this.options.listenPort,this.options.forwardUrl)),e()})})}stop(){return new Promise(e=>{if(!this.server||!this._isRunning){this._isRunning=!1,e();return}let r=setTimeout(()=>{this.log(n.serverForceShutdown),this._isRunning=!1,this.server=null,this.destroyAllConnections(),e()},5e3);this.server.close(()=>{clearTimeout(r),this._isRunning=!1,this.server=null,this.activeConnections.clear(),this.log(n.proxyStopped),e()}),this.destroyAllConnections()})}destroyAllConnections(){for(let e of this.activeConnections)try{e.destroy()}catch{}this.activeConnections.clear()}updateOptions(e){this.options={...this.options,...e}}handleRequest(e,r){let o=(0,K.randomUUID)(),s=Date.now(),a=[],i=0,c=!1;e.on("data",p=>{if(i+=p.length,i<=this.options.maxBodySize)a.push(p);else if(!c){let h=this.options.maxBodySize-(i-p.length);h>0&&a.push(p.subarray(0,h)),c=!0,this.log(n.bodyTruncated(o.slice(0,8),(i/1024/1024).toFixed(1),(this.options.maxBodySize/1024/1024).toFixed(0)))}}),e.on("end",()=>{let p=Buffer.concat(a),h=e.headers["content-type"]||"",m={id:o,method:e.method||"GET",url:e.url||"/",headers:this.normalizeHeaders(e.headers),rawBody:p.toString("base64"),bodySize:i,bodyTruncated:c,contentType:h,timestamp:new Date().toISOString()};this.log(n.requestReceived(m.method,m.url,i,c)),this.forwardRequest(m,p,s).then(l=>{let S={request:m,...l};if(this.store.addEntry(S),l.response){let f=Buffer.from(l.response.rawBody,"base64");r.writeHead(l.response.statusCode,l.response.headers),r.end(f),this.log(n.responseReceived(l.response.statusCode,l.response.responseTime,l.response.bodySize))}else if(l.error){let f=this.errorToStatusCode(l.error.code);r.writeHead(f,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:n.forwardErrorJson,message:l.error.message,code:l.error.code})),this.log(n.forwardError(l.error.message))}}).catch(l=>{let S={request:m,error:{code:"UNEXPECTED",message:n.unexpectedError(l.message)}};this.store.addEntry(S),r.writeHead(500,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:n.unexpectedErrorJson,message:l.message})),this.log(n.unexpectedError(l.message))})}),e.on("error",p=>{this.log(n.requestReadError(p.message)),r.writeHead(400),r.end("Bad Request")})}forwardRequest(e,r,o){return new Promise(s=>{try{let a=new V.URL(e.url,this.options.forwardUrl),i=a.protocol==="https:",c=i?ve:D,p={...e.headers};p.host=a.host,(e.bodyTruncated||r.length>0&&!p["content-length"])&&(p["content-length"]=String(r.length));let h={hostname:a.hostname,port:a.port||(i?443:80),path:a.pathname+a.search,method:e.method,headers:p,timeout:this.options.forwardTimeout},m=c.request(h,l=>{let S=[];l.on("data",f=>{S.push(f)}),l.on("end",()=>{let f=Buffer.concat(S),_=Date.now()-o,I={statusCode:l.statusCode||0,headers:this.normalizeHeaders(l.headers),rawBody:f.toString("base64"),bodySize:f.length,responseTime:_};s({response:I})}),l.on("error",f=>{s({error:{code:"RESPONSE_ERROR",message:`Yan\u0131t okunurken hata: ${f.message}`}})})});m.on("timeout",()=>{m.destroy();let l=Date.now()-o;s({error:{code:"ETIMEDOUT",message:`Target server did not respond within ${this.options.forwardTimeout/1e3} seconds (${this.options.forwardUrl}).`}})}),m.on("error",l=>{let S=l.code||"UNKNOWN",f;switch(S){case"ECONNREFUSED":f=`Target server is not responding (${this.options.forwardUrl}). Make sure the server is running.`;break;case"ECONNRESET":f=`Target server closed the connection (${this.options.forwardUrl}).`;break;case"ENOTFOUND":f=`Target server not found: ${this.options.forwardUrl}`;break;default:f=`Forward error (${S}): ${l.message}`}s({error:{code:S,message:f}})}),r.length>0&&m.write(r),m.end()}catch(a){s({error:{code:"INVALID_URL",message:`Ge\xE7ersiz hedef URL: ${a.message}`}})}})}errorToStatusCode(e){switch(e){case"ECONNREFUSED":case"ECONNRESET":case"ENOTFOUND":return 502;case"ETIMEDOUT":return 504;default:return 502}}normalizeHeaders(e){let r={};for(let[o,s]of Object.entries(e))s!==void 0&&(r[o]=s);return r}log(e){this.onLog&&this.onLog(e)}};var Y=require("events");function U(t){return{id:t.request.id,method:t.request.method,url:t.request.url,statusCode:t.response?.statusCode??null,responseTime:t.response?.responseTime??null,timestamp:t.request.timestamp,contentType:t.request.contentType,bodySize:t.request.bodySize,hasError:!!t.error,errorMessage:t.error?.message}}var q=class extends Y.EventEmitter{constructor(r=200){super();this.entries=new Map;this.insertionOrder=[];this.maxEntries=r}addEntry(r){for(;this.insertionOrder.length>=this.maxEntries;){let o=this.insertionOrder.shift();o&&this.entries.delete(o)}this.entries.set(r.request.id,r),this.insertionOrder.push(r.request.id),this.emit("entryAdded",r)}updateEntry(r,o){let s=this.entries.get(r);if(!s)return;let a={...s,...o};this.entries.set(r,a),this.emit("entryUpdated",a)}getAll(){return this.insertionOrder.map(r=>this.entries.get(r)).filter(r=>r!==void 0)}getAllSummaries(){return this.getAll().map(U)}getById(r){return this.entries.get(r)}clear(){this.entries.clear(),this.insertionOrder=[],this.emit("cleared")}get size(){return this.entries.size}get isEmpty(){return this.entries.size===0}dispose(){this.clear(),this.removeAllListeners()}};var w=R(require("vscode"));var H=R(require("vscode")),X=R(require("https")),g=null,F=null,k="webhookInspector.licenseKey",P="webhookInspector.licenseStatus",C="webhookInspector.licenseCache";var Se=10080*60*1e3,Q=!1;function Z(t,e){g=t,e&&(F=e)}function xe(t){if(F){let e=new Date().toISOString().substring(11,19);F.appendLine(`[${e}] ${t}`)}}function $(){return g?g.globalState.get(P,"free"):"free"}async function ee(){g&&(await g.globalState.update(k,void 0),await g.globalState.update(P,"free"),await g.globalState.update(C,void 0))}async function te(t){if(!g)return{success:!1,error:"Extension not initialized"};let e=t.trim();if(e.length<16)return{success:!1,error:"Key too short"};if(Q)return await g.globalState.update(k,e),await g.globalState.update(P,"pro"),await g.globalState.update(C,{valid:!0,checkedAt:Date.now(),key:e}),{success:!0};let r=H.env.machineId;try{let o=await oe(e,r);return o.valid?(await g.globalState.update(k,e),await g.globalState.update(P,"pro"),await g.globalState.update(C,{valid:!0,checkedAt:Date.now(),key:e}),{success:!0}):(await g.globalState.update(k,void 0),await g.globalState.update(P,"free"),await g.globalState.update(C,void 0),{success:!1,error:o.error||"Invalid key"})}catch(o){let s=g.globalState.get(C);return s&&s.key===e&&s.valid?(await g.globalState.update(k,e),await g.globalState.update(P,"pro"),{success:!0}):{success:!1,error:`Network error: ${o.message}`}}}async function re(){if(!g)return;let t=g.globalState.get(C);if(!(!t||!t.valid||Date.now()-t.checkedAt<Se)&&!Q)try{(await oe(t.key,H.env.machineId)).valid?await g.globalState.update(C,{valid:!0,checkedAt:Date.now(),key:t.key}):(await g.globalState.update(P,"free"),await g.globalState.update(C,void 0),await g.globalState.update(k,void 0))}catch{}}function oe(t,e){return new Promise((r,o)=>{let s=`license_key=${encodeURIComponent(t)}&instance_name=${encodeURIComponent(`vscode-${e}`)}`,a=X.request({hostname:"api.lemonsqueezy.com",port:443,path:"/v1/licenses/validate",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":Buffer.byteLength(s),Accept:"application/json"},timeout:15e3},i=>{let c=[];i.on("data",p=>c.push(p)),i.on("end",()=>{try{let p=Buffer.concat(c).toString("utf-8"),h=JSON.parse(p);if(h.license_key?.test_mode===!0){xe("Test mode license rejected"),r({valid:!1,error:"Test mode licenses are not accepted"});return}if(h.valid===!0)r({valid:!0});else{let m=h.license_key?.status,l="Invalid license key";m==="expired"?l="License has expired":m==="disabled"&&(l="License has been disabled"),r({valid:!1,error:l})}}catch{r({valid:!1,error:"Invalid server response"})}})});a.on("error",i=>o(i)),a.on("timeout",()=>{a.destroy(),o(new Error("Request timed out"))}),a.write(s),a.end()})}var x=class t{constructor(e,r,o){this.disposables=[];this.onReplayRequest=null;this.onStartProxy=null;this.onStopProxy=null;this.onCopyAsCurl=null;this.onExportHistory=null;this.onUpdateSettings=null;this.onGetSettings=null;this.onActivateLicense=null;this.panel=e,this.store=r,this.proxyServer=o,this.panel.webview.onDidReceiveMessage(c=>{this.handleWebviewMessage(c)},null,this.disposables),this.panel.onDidDispose(()=>{this.dispose(),t.instance=null},null,this.disposables);let s=c=>{this.postMessage({type:"newRequest",request:U(c)})},a=c=>{this.postMessage({type:"requestUpdated",request:U(c)})},i=()=>{this.postMessage({type:"historyCleared"})};this.store.on("entryAdded",s),this.store.on("entryUpdated",a),this.store.on("cleared",i),this.disposables.push({dispose:()=>{this.store.removeListener("entryAdded",s),this.store.removeListener("entryUpdated",a),this.store.removeListener("cleared",i)}})}static{this.instance=null}static createOrShow(e,r,o){if(t.instance)return t.instance.proxyServer=o,t.instance.panel.reveal(w.ViewColumn.One),t.instance;let s=w.window.createWebviewPanel("webhookInspector","Webhook Inspector",w.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[w.Uri.joinPath(e,"webview-ui","dist")]});s.iconPath=w.Uri.joinPath(e,"resources","icon.png"),s.webview.html=t.getWebviewHtml(s.webview,e);let a=new t(s,r,o);return t.instance=a,a}updateProxyServer(e){this.proxyServer=e}static getInstance(){return t.instance}handleWebviewMessage(e){switch(e.type){case"webviewReady":this.handleWebviewReady();break;case"getRequestDetail":this.handleGetRequestDetail(e.requestId);break;case"replayRequest":this.handleReplayRequest(e.requestId);break;case"clearHistory":this.store.clear();break;case"startProxy":this.onStartProxy&&this.onStartProxy();break;case"stopProxy":this.onStopProxy&&this.onStopProxy();break;case"copyAsCurl":this.onCopyAsCurl&&this.onCopyAsCurl(e.requestId);break;case"exportHistory":this.onExportHistory&&this.onExportHistory();break;case"getSettings":this.onGetSettings&&this.onGetSettings();break;case"updateSettings":this.onUpdateSettings&&this.onUpdateSettings(e.listenPort,e.forwardUrl);break;case"activateLicense":this.onActivateLicense&&this.onActivateLicense(e.licenseKey);break;case"openExternalUrl":w.env.openExternal(w.Uri.parse(e.url));break}}handleWebviewReady(){this.postMessage({type:"init",locale:w.env.language,licenseStatus:$()}),this.postMessage({type:"proxyStatus",isRunning:this.proxyServer?.isRunning??!1,listenPort:this.proxyServer?.listenPort??3001,forwardUrl:this.proxyServer?.forwardUrl??"http://localhost:3000"}),this.postMessage({type:"allRequests",requests:this.store.getAllSummaries()})}handleGetRequestDetail(e){let r=this.store.getById(e);r&&this.postMessage({type:"requestDetail",request:r.request,response:r.response,error:r.error})}async handleReplayRequest(e){this.onReplayRequest&&await this.onReplayRequest(e)}postMessage(e){this.panel.webview.postMessage(e)}static getWebviewHtml(e,r){let o=w.Uri.joinPath(r,"webview-ui","dist"),s=e.asWebviewUri(w.Uri.joinPath(o,"assets","index.js")),a=e.asWebviewUri(w.Uri.joinPath(o,"assets","index.css")),i=Re();return`<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'none';
      style-src ${e.cspSource} 'unsafe-inline';
      script-src 'nonce-${i}';
      font-src ${e.cspSource};
      img-src ${e.cspSource} data:;
    ">
    <link rel="stylesheet" href="${a}">
    <title>Webhook Inspector</title>
</head>
<body>
    <div id="root"></div>
    <script nonce="${i}" src="${s}"></script>
</body>
</html>`}dispose(){for(let e of this.disposables)e.dispose();this.disposables=[]}};function Re(){let t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}var se=R(require("net")),Ee=3e3;function ne(t){return new Promise(e=>{let r=!1,o=i=>{r||(r=!0,clearTimeout(s),e(i))},s=setTimeout(()=>{o(!1);try{a.destroy()}catch{}},Ee),a=se.connect({port:t,host:"127.0.0.1"},()=>{a.destroy(),o(!1)});a.on("error",i=>{a.destroy(),i.code==="ECONNREFUSED"?o(!0):o(!1)})})}function ie(t){return Number.isInteger(t)&&t>=1024&&t<=65535}function ae(t,e){let{request:r}=t,o=["curl"];r.method!=="GET"&&o.push(`-X ${r.method}`);let s=`${e.replace(/\/$/,"")}${r.url}`;o.push(`"${s}"`);let a=new Set(["host","content-length","connection"]);for(let[i,c]of Object.entries(r.headers)){if(a.has(i.toLowerCase()))continue;let p=Array.isArray(c)?c.join(", "):String(c);o.push(`-H "${i}: ${p}"`)}if(r.bodySize>0&&r.rawBody){let i=Ce(r.rawBody);if(i!==null)if(i.length>4e3)o.push("-d @body.json"),o.push(`
# Body \xE7ok uzun (${r.bodySize} byte), dosyaya kaydedin`);else{let c=i.replace(/"/g,'\\"');o.push(`-d "${c}"`)}else o.push("--data-binary @body.bin"),o.push(`
# Binary body (${r.bodySize} byte)`)}return o.join(` \\
  `)}function Ce(t){try{let e=Buffer.from(t,"base64"),r=Math.min(e.length,1024);for(let o=0;o<r;o++)if(e[o]===0)return null;return e.toString("utf-8")}catch{return null}}function le(t){let e=t.map(o=>Pe(o));return JSON.stringify({log:{version:"1.2",creator:{name:"Webhook Inspector",version:"0.0.1"},entries:e}},null,2)}function Pe(t){let{request:e,response:r,error:o}=t,s={method:e.method,url:e.url,httpVersion:"HTTP/1.1",cookies:[],headers:de(e.headers),queryString:ke(e.url),headersSize:-1,bodySize:e.bodySize};e.bodySize>0&&(s.postData={mimeType:e.contentType||"application/octet-stream",text:ce(e.rawBody)});let a;return r?a={status:r.statusCode,statusText:Te(r.statusCode),httpVersion:"HTTP/1.1",cookies:[],headers:de(r.headers),content:{size:r.bodySize,mimeType:Ie(r.headers),text:ce(r.rawBody)},redirectURL:"",headersSize:-1,bodySize:r.bodySize}:a={status:0,statusText:o?o.message:"No response",httpVersion:"HTTP/1.1",cookies:[],headers:[],content:{size:0,mimeType:"text/plain"},redirectURL:"",headersSize:-1,bodySize:0},{startedDateTime:e.timestamp,time:r?.responseTime??0,request:s,response:a,cache:{},timings:{send:0,wait:r?.responseTime??0,receive:0}}}function de(t){return Object.entries(t).map(([e,r])=>({name:e,value:Array.isArray(r)?r.join(", "):r}))}function ke(t){let e=t.indexOf("?");if(e===-1)return[];let r=t.slice(e+1),o=[];for(let s of r.split("&")){let[a,...i]=s.split("=");o.push({name:decodeURIComponent(a||""),value:decodeURIComponent(i.join("=")||"")})}return o}function ce(t){if(!t)return"";try{return Buffer.from(t,"base64").toString("utf-8")}catch{return"[Binary i\xE7erik]"}}function Ie(t){let e=t["content-type"];return e?Array.isArray(e)?e[0]:e:"application/octet-stream"}function Te(t){return{200:"OK",201:"Created",204:"No Content",301:"Moved Permanently",302:"Found",304:"Not Modified",400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",409:"Conflict",422:"Unprocessable Entity",429:"Too Many Requests",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout"}[t]||""}var u=null,y=null,b=null,L=null,ue;function Ue(t){ue=t.extensionUri,L=d.window.createOutputChannel("Webhook Inspector"),t.subscriptions.push(L),Z(t,L),re();let r=d.workspace.getConfiguration("webhookInspector").get("maxEntries",200);y=new q(r),b=d.window.createStatusBarItem(d.StatusBarAlignment.Left,100),b.command="webhookInspector.openPanel",W(!1),b.show(),t.subscriptions.push(b);let o=d.commands.registerCommand("webhookInspector.startProxy",async()=>{await B()});t.subscriptions.push(o);let s=d.commands.registerCommand("webhookInspector.stopProxy",async()=>{await O()});t.subscriptions.push(s);let a=d.commands.registerCommand("webhookInspector.openPanel",()=>{$e()});t.subscriptions.push(a);let i=d.commands.registerCommand("webhookInspector.clearHistory",()=>{y&&(y.clear(),v(n.historyCleared),d.window.showInformationMessage(n.historyClearedNotif))});t.subscriptions.push(i);let c=d.commands.registerCommand("webhookInspector.resetLicense",async()=>{await ee();let h=x.getInstance();h&&h.postMessage({type:"licenseStatus",status:$()}),d.window.showInformationMessage(n.licenseResetNotif),v(n.licenseReset)});t.subscriptions.push(c);let p=d.workspace.onDidChangeConfiguration(h=>{h.affectsConfiguration("webhookInspector")&&Le()});t.subscriptions.push(p),t.subscriptions.push({dispose:()=>{u?.isRunning&&u.stop().catch(()=>{}),y?.dispose()}}),v(n.activated)}async function qe(){u?.isRunning&&await u.stop(),y?.dispose(),v(n.deactivated)}function $e(){if(!y)return;let t=x.createOrShow(ue,y,u);t.onReplayRequest=async e=>{if(!y)return;let r=y.getById(e);if(!r||await d.window.showWarningMessage(n.replayWarning,{modal:!0},n.replayContinue)!==n.replayContinue)return;v(n.replayStart(r.request.method,r.request.url));let a=d.workspace.getConfiguration("webhookInspector").get("forwardUrl","http://localhost:3000");try{let i=await import("http"),c=await import("https"),{URL:p}=await import("url"),h=Buffer.from(r.request.rawBody,"base64"),m=new p(r.request.url,a),l=m.protocol==="https:",S=l?c:i,f=Date.now();await new Promise(I=>{let z={...r.request.headers};z.host=m.host,h.length>0&&(z["content-length"]=String(h.length));let T=S.request({hostname:m.hostname,port:m.port||(l?443:80),path:m.pathname+m.search,method:r.request.method,headers:z,timeout:3e4},E=>{let j=[];E.on("data",M=>j.push(M)),E.on("end",()=>{let M=Buffer.concat(j),G=Date.now()-f;t.postMessage({type:"replayResult",originalRequestId:e,response:{statusCode:E.statusCode||0,headers:Me(E.headers),rawBody:M.toString("base64"),bodySize:M.length,responseTime:G}}),v(n.replayResult(E.statusCode||0,G)),I()})});T.on("error",E=>{t.postMessage({type:"replayResult",originalRequestId:e,error:{code:E.code||"UNKNOWN",message:n.replayError(E.message)}}),v(n.replayError(E.message)),I()}),T.on("timeout",()=>{T.destroy(),t.postMessage({type:"replayResult",originalRequestId:e,error:{code:"ETIMEDOUT",message:n.replayTimeout}}),I()}),h.length>0&&T.write(h),T.end()})}catch(i){v(n.replayError(i.message))}},t.onStartProxy=async()=>{await B();let e=x.getInstance();e&&u&&(e.updateProxyServer(u),e.postMessage({type:"proxyStatus",isRunning:u.isRunning,listenPort:u.listenPort,forwardUrl:u.forwardUrl}))},t.onStopProxy=async()=>{await O();let e=x.getInstance();e&&(e.updateProxyServer(null),e.postMessage({type:"proxyStatus",isRunning:!1,listenPort:u?.listenPort??3001,forwardUrl:u?.forwardUrl??"http://localhost:3000"}))},t.onCopyAsCurl=e=>{if(!y)return;let r=y.getById(e);if(!r)return;let s=d.workspace.getConfiguration("webhookInspector").get("forwardUrl","http://localhost:3000"),a=ae(r,s);d.env.clipboard.writeText(a).then(()=>{d.window.showInformationMessage(n.curlCopiedNotif)}),v(n.curlCopied(r.request.method,r.request.url))},t.onExportHistory=async()=>{if(!y)return;let e=y.getAll();if(e.length===0){d.window.showWarningMessage(n.noRequestsToExport);return}let r=le(e),o=await d.window.showSaveDialog({defaultUri:d.Uri.file(`webhook-inspector-${Date.now()}.har`),filters:{[n.harFileFilter]:["har"],JSON:["json"]}});o&&(await d.workspace.fs.writeFile(o,Buffer.from(r,"utf-8")),d.window.showInformationMessage(n.harExportedNotif(e.length)),v(n.harExported(e.length,o.fsPath)))},t.onGetSettings=()=>{let e=d.workspace.getConfiguration("webhookInspector"),r=e.get("listenPort",3001),o=e.get("forwardUrl","http://localhost:3000");t.postMessage({type:"settingsLoaded",listenPort:r,forwardUrl:o})},t.onUpdateSettings=async(e,r)=>{let o=d.workspace.getConfiguration("webhookInspector");if(await o.update("listenPort",e,d.ConfigurationTarget.Global),await o.update("forwardUrl",r,d.ConfigurationTarget.Global),v(n.settingsUpdated(e,r)),u?.isRunning){await O(),await B();let s=x.getInstance();s&&u&&(s.updateProxyServer(u),s.postMessage({type:"proxyStatus",isRunning:u.isRunning,listenPort:u.listenPort,forwardUrl:u.forwardUrl}))}d.window.showInformationMessage(n.settingsUpdatedNotif)},t.onActivateLicense=async e=>{let r=await te(e);t.postMessage({type:"activateLicenseResult",success:r.success,error:r.error}),r.success?(t.postMessage({type:"licenseStatus",status:$()}),d.window.showInformationMessage(n.licenseActivatedNotif),v(n.licenseActivated)):v(n.licenseInvalid)}}async function B(){if(u?.isRunning){d.window.showWarningMessage(n.proxyAlreadyRunning(u.listenPort));return}let t=d.workspace.getConfiguration("webhookInspector"),e=t.get("listenPort",3001),r=t.get("forwardUrl","http://localhost:3000"),o=t.get("forwardTimeout",3e4),s=t.get("maxBodySize",5242880);if(!ie(e)){d.window.showErrorMessage(n.invalidPort(e));return}if(!await ne(e)){d.window.showErrorMessage(n.portInUseNotif(e));return}try{new URL(r)}catch{d.window.showErrorMessage(n.invalidForwardUrl(r));return}if(!y){let i=t.get("maxEntries",200);y=new q(i)}u=new N(y,{listenPort:e,forwardUrl:r,forwardTimeout:o,maxBodySize:s}),u.onLog=i=>v(i),u.onUnexpectedStop=i=>{v(n.proxyUnexpectedStop(i)),W(!1),d.window.showErrorMessage(`Webhook Inspector: ${i}`);let c=x.getInstance();c&&(c.postMessage({type:"proxyError",errorType:"unexpectedStop",message:i}),c.postMessage({type:"proxyStatus",isRunning:!1,listenPort:u?.listenPort??3001,forwardUrl:u?.forwardUrl??"http://localhost:3000"}))};try{await u.start(),W(!0,e);let i=x.getInstance();i&&(i.updateProxyServer(u),i.postMessage({type:"proxyStatus",isRunning:!0,listenPort:e,forwardUrl:r})),d.window.showInformationMessage(n.proxyStartedNotif(e,r))}catch(i){let c=i.message||n.unknownError,p=c.includes("in use")||c.includes("EADDRINUSE");d.window.showErrorMessage(`Webhook Inspector: ${c}`);let h=x.getInstance();h&&h.postMessage({type:"proxyError",errorType:p?"portInUse":"startFailed",message:c}),u=null}}async function O(){if(!u?.isRunning){d.window.showWarningMessage(n.proxyAlreadyStopped);return}await u.stop(),W(!1);let t=x.getInstance();t&&t.postMessage({type:"proxyStatus",isRunning:!1,listenPort:u?.listenPort??3001,forwardUrl:u?.forwardUrl??"http://localhost:3000"}),d.window.showInformationMessage(n.proxyStoppedNotif)}function W(t,e){b&&(t&&e?(b.text=n.statusListening(e),b.tooltip=new d.MarkdownString(n.tooltipActive(e)),b.backgroundColor=new d.ThemeColor("statusBarItem.warningBackground"),b.color=void 0):(b.text=n.statusStopped,b.tooltip=new d.MarkdownString(n.tooltipStopped),b.backgroundColor=void 0,b.color=void 0))}function Le(){u?.isRunning&&d.window.showInformationMessage(n.settingsChanged,n.settingsRestart).then(async t=>{t===n.settingsRestart&&(await O(),await B())})}function Me(t){let e={};for(let[r,o]of Object.entries(t))o!==void 0&&(e[r]=o);return e}function v(t){if(L){let e=new Date().toISOString().substring(11,19);L.appendLine(`[${e}] ${t}`)}}0&&(module.exports={activate,deactivate,proxyServer,requestStore});
